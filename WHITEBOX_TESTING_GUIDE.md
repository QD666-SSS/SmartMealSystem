# 营养推荐系统白盒测试操作指南

## 概述

本指南详细说明如何在营养推荐系统中进行白盒测试，包括单元测试、集成测试和系统测试的具体操作步骤。

## 4.1 白盒测试操作方法

### 4.1.1 环境准备

1. **确保测试文件存在**
   - 测试主文件：`tests/whitebox_tests.cpp`
   - 已更新的构建配置：`CMakeLists.txt`

2. **构建测试环境**
   ```bash
   # 创建构建目录
   mkdir build && cd build
   
   # 使用CMake配置项目
   cmake ..
   
   # 构建测试可执行文件
   make -j4
   ```

### 4.1.2 运行测试的具体步骤

1. **执行所有白盒测试**
   ```bash
   # 进入构建目录
   cd build
   
   # 运行完整测试套件
   ./bin/MealRecommendationSystem_tests
   ```

2. **测试输出示例**
   ```
   ========================================
   营养推荐系统白盒测试套件
   基于C++单元测试框架
   ========================================
   
   --- 测试用户类：25岁男性，中等活动水平 ---
   期望卡路里: 2683.4375
   实际卡路里: 2683.44
   误差: 0.0025
   期望蛋白质: 84g, 实际: 84g
   期望碳水: 335.43g, 实际: 335.43g
   期望脂肪: 74.54g, 实际: 74.54g
   ✓ 男性中等活动测试通过！
   
   --- 测试用户类：30岁女性，轻度活动 ---
   ✓ 女性轻度活动测试通过！
   
   --- 测试中文性别识别 ---
   中文性别测试 - 期望卡路里: 2185.64
   中文性别测试 - 实际卡路里: 2185.64
   ✓ 中文性别测试通过！
   
   --- 测试用户偏好标签管理 ---
   ✓ 用户偏好标签管理测试通过！
   
   --- 测试推荐引擎初始化 ---
   ✓ 推荐引擎初始化成功！
   
   --- 测试食物选择算法 ---
   早餐总热量: 650.5
   包含主食: 是
   包含蛋白质: 是
   ✓ 食物选择算法测试通过！
   
   --- 测试数据库操作 ---
   ✓ 用户保存成功
   ✓ 用户读取成功，总数: 1
   ✓ 用户信息验证正确
   ✓ 数据库操作测试通过！
   
   --- 测试食物创建和属性 ---
   ✓ 食物创建和属性测试通过！
   
   --- 测试食物营养计算 ---
   150g鸡胸肉热量: 247.5 (期望: 247.5)
   ✓ 食物营养计算测试通过！
   
   --- 测试餐食创建 ---
   ✓ 餐食创建测试通过！
   
   --- 测试餐食营养计算 ---
   早餐总热量: 397.5 kcal
   早餐总蛋白质: 35.15 g
   早餐总碳水: 42 g
   早餐总脂肪: 1.82 g
   ✓ 餐食营养计算测试通过！
   
   --- 测试边界条件 ---
   ✓ 120岁用户计算正常
   ✓ 200kg用户计算正常
   ✓ 极低体重用户计算正常
   ✓ 边界条件测试通过！
   
   --- 测试系统性能 ---
   创建1000个用户并计算营养目标耗时: 45 ms
   ✓ 性能测试通过！
   
   ========================================
   所有白盒测试通过！✓
   ========================================
   
   🎉 所有测试完成！系统白盒测试通过。
   ```

### 4.1.3 各测试模块详细说明

#### A. 用户类测试 (User Class Tests)

**测试目的：** 验证用户营养目标计算算法的正确性

**具体操作：**

1. **营养目标计算测试**
   ```cpp
   void testCalculateNutritionGoals_MaleModerate() {
       User user1(1, "test1", "password");
       user1.setAge(25);
       user1.setGender("male");
       user1.setWeight(70.0);
       user1.setHeight(175.0);
       user1.setActivityLevel("moderate");
       
       user1.calculateNutritionGoals();
       
       // 期望值计算
       // BMR = 10 * 70 + 6.25 * 175 - 5 * 25 + 5 = 1731.25
       // 每日总消耗 = 1731.25 * 1.55 = 2683.4375
   }
   ```

2. **测试用例执行**
   - 创建具有特定属性的用户对象
   - 调用营养目标计算函数
   - 验证计算结果与预期值的差异
   - 检查合理性边界

3. **预期结果**
   - 卡路里误差 < 1 kcal
   - 蛋白质、碳水、脂肪计算准确
   - 中文性别识别正常工作

#### B. 推荐引擎测试 (RecommendationEngine Tests)

**测试目的：** 验证食物选择算法的有效性

**具体操作：**

1. **食物选择算法测试**
   ```cpp
   void testFoodSelectionAlgorithm() {
       RecommendationEngine engine;
       engine.initializeSampleData();
       
       User user(1, "test", "password");
       user.setDailyCalorieGoal(2000);
       user.setDailyProteinGoal(75);
       
       Meal breakfast = engine.selectFoodsForMeal(user, "breakfast");
       
       // 验证早餐热量在合理范围内 (500-800卡路里)
       // 验证包含合适类型的食物
   }
   ```

2. **测试重点**
   - 热量控制准确性
   - 食物类型多样性
   - 营养均衡性

#### C. 数据库操作测试 (Database Tests)

**测试目的：** 验证数据持久化和读取功能

**具体操作：**

1. **数据持久化测试**
   - 创建测试用户对象
   - 保存到临时数据库文件
   - 读取并验证数据完整性
   - 清理测试数据

2. **测试覆盖范围**
   - 用户信息保存/读取
   - 数据格式正确性
   - 并发操作安全性

#### D. 边界条件测试

**测试目的：** 验证系统在极端条件下的稳定性

**测试场景：**
- 极端年龄（120岁）
- 极端体重（200kg）
- 极低体重（0.1kg）
- 边界值测试

### 4.1.4 性能测试操作

**测试目的：** 验证系统性能是否满足要求

**测试方法：**
```cpp
void testPerformance() {
    auto start = chrono::high_resolution_clock::now();
    
    // 创建1000个用户并计算营养目标
    vector<User> users;
    for (int i = 0; i < 1000; i++) {
        User user(i, "user" + to_string(i), "password");
        user.calculateNutritionGoals();
        users.push_back(user);
    }
    
    auto end = chrono::high_resolution_clock::now();
    auto duration = chrono::duration_cast<chrono::milliseconds>(end - start);
    
    assert(duration.count() < 1000); // 应该在1秒内完成
}
```

**性能标准：**
- 1000个用户营养目标计算 < 1秒
- 内存使用合理
- 无内存泄漏

### 4.1.5 错误处理测试

**测试目的：** 验证异常情况下的系统行为

**测试场景：**
- 无效输入数据
- 文件操作失败
- 网络连接异常
- 数据格式错误

### 4.1.6 测试报告生成

**运行测试后，检查以下内容：**

1. **所有测试用例通过率**
   ```
   ========================================
   所有白盒测试通过！✓
   ========================================
   ```

2. **性能指标**
   - 测试执行时间
   - 内存使用情况
   - CPU占用率

3. **覆盖率分析**
   - 代码行覆盖率
   - 分支覆盖率
   - 函数覆盖率

### 4.1.7 故障排除

**常见问题及解决方案：**

1. **编译错误**
   ```bash
   # 确保包含所有必要的头文件
   # 检查CMakeLists.txt中的源文件配置
   ```

2. **运行时错误**
   ```bash
   # 检查测试数据文件是否存在
   # 验证文件路径权限
   ```

3. **断言失败**
   ```bash
   # 查看具体的断言信息
   # 检查输入数据的合理性
   # 验证计算公式的准确性
   ```

### 4.1.8 持续集成测试

**自动化测试脚本示例：**

```bash
#!/bin/bash
# auto_test.sh

echo "开始白盒测试..."

# 清理构建目录
rm -rf build
mkdir build && cd build

# 配置并构建
cmake ..
make -j4

# 运行测试
./bin/MealRecommendationSystem_tests

if [ $? -eq 0 ]; then
    echo "✅ 所有测试通过！"
else
    echo "❌ 测试失败！"
    exit 1
fi
```

## 测试检查清单

### 4.1.1 功能测试检查点
- [ ] 用户营养目标计算准确性
- [ ] 食物推荐算法有效性
- [ ] 数据库操作可靠性
- [ ] 用户界面交互正常
- [ ] 口味偏好设置功能

### 4.1.2 性能测试检查点
- [ ] 大量用户并发处理
- [ ] 营养计算响应时间
- [ ] 内存使用合理性
- [ ] 数据库查询效率

### 4.1.3 安全性测试检查点
- [ ] 用户数据加密
- [ ] 输入验证机制
- [ ] SQL注入防护
- [ ] XSS攻击防护

### 4.1.4 兼容性测试检查点
- [ ] 不同操作系统兼容性
- [ ] 浏览器兼容性
- [ ] 数据库版本兼容性
- [ ] 网络环境适应性

## 总结

通过上述详细的操作步骤，您可以：

1. **完整执行白盒测试流程**
2. **验证系统各模块功能**
3. **确保代码质量和稳定性**
4. **发现并修复潜在问题**
5. **建立持续的质量保证机制**

白盒测试是保证营养推荐系统质量的重要手段，通过系统化的测试方法，可以有效提高系统的可靠性和用户体验。