# 口味偏好功能测试指南

## 功能说明

智能配餐推荐系统现在支持完整的口味偏好功能，包括：

### 1. 喜欢的口味标签 👍
- 用户可以选择喜欢的口味标签（如：辣、鲜、甜、酸、咸等）
- 推荐系统会优先推荐包含这些标签的食物
- 每个喜欢的标签会为食物增加 +30 分

### 2. 避免的口味标签 👎
- 用户可以选择不喜欢的口味标签
- 推荐系统会尽量避免推荐包含这些标签的食物
- 每个避免的标签会为食物减少 -50 分

### 3. 过敏源 ⚠️
- 用户可以标记过敏的食物标签（如：海鲜、坚果等）
- 推荐系统会完全排除包含这些标签的食物
- 过敏源标签会为食物减少 -1000 分（基本排除）

## 使用方法

### 步骤1: 注册/登录
1. 打开浏览器访问 http://localhost:8000
2. 注册新用户或登录现有用户
3. 填写基本信息（年龄、体重、身高、性别、活动水平）

### 步骤2: 设置口味偏好
1. 点击左侧菜单的"个人信息"进入个人资料页面
2. 向下滚动到"🎯 口味偏好设置"部分
3. 在"👍 喜欢的口味标签"区域，点击你喜欢的口味标签按钮
   - 选中的按钮会变成蓝色并显示阴影效果
4. 在"👎 避免的口味标签"区域，点击你不喜欢的口味标签按钮
5. 在"⚠️ 过敏源"区域，点击你过敏的食物标签按钮
6. 点击底部的"💾 保存个人信息和口味偏好"按钮保存设置

### 步骤3: 查看推荐效果
1. 点击左侧菜单的"智能推荐"
2. 选择日期并点击"生成推荐"
3. 系统会根据你的口味偏好生成个性化的餐单
4. 推荐的食物会优先包含你喜欢的口味，避免你不喜欢的口味，排除过敏源

## 测试用例

### 测试用例 1: 喜欢辣味和鲜味
1. 设置喜欢的口味：辣、鲜
2. 生成推荐
3. 预期结果：推荐的食物应该包含更多带有"辣"或"鲜"标签的食物

### 测试用例 2: 避免甜味
1. 设置避免的口味：甜
2. 生成推荐
3. 预期结果：推荐的食物应该尽量不包含带有"甜"标签的食物（如红薯、香蕉等）

### 测试用例 3: 海鲜过敏
1. 设置过敏源：海鲜
2. 生成推荐
3. 预期结果：推荐的食物应该完全不包含带有"海鲜"标签的食物（如虾仁、鱼片等）

### 测试用例 4: 综合设置
1. 设置喜欢的口味：鲜、清淡
2. 设置避免的口味：甜
3. 设置过敏源：海鲜、坚果
4. 生成推荐
5. 预期结果：
   - 推荐的食物应该优先包含"鲜"或"清淡"标签
   - 尽量不包含"甜"标签的食物
   - 完全不包含"海鲜"或"坚果"标签的食物

## API 测试

你也可以使用 curl 命令测试 API：

```bash
# 1. 注册用户
curl -X POST http://localhost:8000/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "username":"testuser",
    "password":"test123",
    "age":25,
    "weight":70,
    "height":175,
    "gender":"male",
    "activityLevel":"moderate"
  }'

# 2. 保存口味偏好（使用注册时返回的 token）
curl -X PUT http://localhost:8000/api/user/preferences \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "preferredTags":["辣","鲜"],
    "avoidedTags":["甜"],
    "allergens":["海鲜"]
  }'

# 3. 获取用户信息（验证偏好已保存）
curl http://localhost:8000/api/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## 技术实现

### 后端 (C++)
- `User` 类包含三个 `std::set<std::string>` 字段存储偏好标签
- `Database` 类支持从文件加载和保存用户偏好（pipe分隔格式）
- `WebServer` 提供 `PUT /api/user/preferences` 端点保存偏好
- `RecommendationEngine` 使用偏好标签计算食物评分

### 前端 (JavaScript)
- `loadProfile()` 加载用户资料和食物数据
- `extractAndDisplayAvailableTags()` 从食物数据中提取所有可用标签
- `displayTagButtons()` 动态创建可点击的标签按钮
- `savePreferences()` 收集选中的标签并通过 API 保存

### 评分算法
```
食物得分 = 基础分 + (喜欢标签匹配数 × 30) + (避免标签匹配数 × -50) + (过敏源匹配数 × -1000)
```

## 已知限制
- 标签是从现有食物数据中提取的，不支持自定义标签
- 偏好设置需要与个人信息一起保存（点击"保存个人信息和口味偏好"按钮）
- 标签是中文文本，依赖于食物数据的标签质量

## 支持的口味标签
系统当前支持的口味标签包括：
- 清淡
- 甜
- 鲜
- 酸
- 咸
- 香
- 海鲜（可作为过敏源）

可以在"食物库"页面查看所有食物及其标签。
